name: Trigger Empty Commit on Issue Update

on:
  issue_comment:
    types: [created, edited]

jobs:
  trigger-empty-commit:
    runs-on: ubuntu-latest
    steps:
      - name: Check if the comment is on the target issue
        id: check-issue
        run: |
          if [ "${{ github.event.issue.number }}" != "1" ]; then
            echo "should_trigger=false" >> $GITHUB_OUTPUT
          else
            echo "should_trigger=true" >> $GITHUB_OUTPUT
          fi

      - name: Trigger empty commit in lawtee.github.io
        if: steps.check-issue.outputs.should_trigger == 'true'
        uses: actions/github-script@v6
        env:
          PAT: ${{ secrets.PAT }}  # 确保 secrets.PAT 已正确设置
        with:
          script: |
            const { execSync } = require('child_process');
            const repo = 'h2dcc/lawtee.github.io';
            const token = process.env.PAT;  // 从环境变量获取 PAT

            try {
              // 使用正确的 Git URL 格式（含 PAT）
              const repoUrl = `https://x-access-token:${token}@github.com/${repo}.git`;
              console.log(`Cloning ${repo}...`);
              
              execSync(`git clone ${repoUrl}`);
              process.chdir('lawtee.github.io');

              // 配置 Git 身份
              execSync('git config user.name "github-actions[bot]"');
              execSync('git config user.email "41898282+github-actions[bot]@users.noreply.github.com"');

              // 创建空提交并推送
              execSync('git commit --allow-empty -m "Trigger update from moments/issues/1"');
              execSync(`git push ${repoUrl} master`);
              console.log('✅ Empty commit pushed successfully!');
            } catch (error) {
              console.error('❌ Error:', error.message);
              process.exit(1);
            }
